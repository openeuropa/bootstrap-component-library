{% spaceless %}

{# Parameters:
  - id (string) (default: '')
  - trigger (object of Button or Link component)
  - link (boolean) (default: false)
  - direction (string) (default: '')
    - options ['dropup', 'dropend', 'dropstart']
  - alignment (string) (default: '')
    - options [
      'dropdown-menu-end',
      'dropdown-menu-sm-end',
      'dropdown-menu-md-end',
      'dropdown-menu-lg-end',
      'dropdown-menu-xl-end',
      'dropdown-menu-xxl-end',
      'dropdown-menu-start',
      'dropdown-menu-sm-start',
      'dropdown-menu-md-start',
      'dropdown-menu-lg-start',
      'dropdown-menu-xl-start',
      'dropdown-menu-xxl-start'
    ]
  - dark (boolean) (default: false)
  - remove_wrapper (boolean) (default: false)
  - items (array of objects)
    format: [
      {
        - Link or Button object component
        - active (boolean)
        - divider (bolean) - show divider
        - button (boolean) - set to button
      }
    ]
#}

{% set _id = id|default('dropdown-' ~ random(1000)) %}
{% set _trigger = trigger|default({}) %}
{% set _link = link|default(false) %}
{% set _direction = direction|default('') %}
{% set _alignment = alignment|default('') %}
{% set _dark = dark|default(false) %}
{% set _remove_wrapper = remove_wrapper|default(false) %}
{% set _items = items|default([]) %}
{% set _class = 'dropdown' %}
{% set _dropdown_class = 'dropdown-menu' %}

{% if _dark %}
  {% set _dropdown_class = _dropdown_class ~ ' dropdown-menu-dark' %}
{% endif %}
{% if _alignment %}
  {% set _dropdown_class = _dropdown_class ~ ' ' ~ _alignment %}
{% endif %}
{% if _direction %}
  {% set _class = _class ~ ' ' ~ _direction %}
{% endif %}

{% set _trigger_extra_classes = 'dropdown-toggle' %}
{% if _trigger.extra_classes is not empty %}
  {% set _trigger_extra_classes = _trigger_extra_classes ~ ' ' ~ _trigger.extra_classes %}
{% endif %}

{% set _trigger_attributes = [
    { name: "aria-expanded", value: "false" },
    { name: "data-bs-toggle", value: 'dropdown' },
  ]
%}
{% if _link %}
  {% set _trigger_attributes = _trigger_attributes|merge([
    { name: "role", value: "button" }]) %}
{% else %}
  {% set _trigger_attributes = _trigger_attributes|merge([
    { name: "autocomplete", value: "off" }]) %}
{% endif %}

{% set _trigger = _trigger|merge({
  id: _id,
  extra_classes: _trigger_extra_classes,
  extra_attributes: _trigger_attributes,
  attributes: attributes })
%}

{% if not _remove_wrapper %}
<div class="{{ _class }}">
{% endif %}
  {% if _link %}
    {% include '@oe-bcl/link/link.html.twig' with _trigger only %}
  {% else %}
    {% include '@oe-bcl/button/button.html.twig' with _trigger only %}
  {% endif %}
  <ul class="{{ _dropdown_class }}" aria-labelledby="{{ _id }}">
    {% if _items is not empty and _items is iterable %}
      {% for _item in _items %}
        {% set _extra_classes = 'dropdown-item' %}
        {% if _item.active %}
          {% set _extra_classes = _extra_classes ~ ' active' %}
        {% endif %}
        {% set _item = _item|merge({
          extra_classes: _extra_classes,
          clean_class: true }) %}
        <li>
        {% if _item.divider is defined %}
          <hr class="dropdown-divider">
        {% elseif _item.button is defined %}
          {% include '@oe-bcl/button/button.html.twig' with _item|merge({
            attributes: attributes
          }) only %}
        {% else %}
          {% include '@oe-bcl/link/link.html.twig' with _item only %}
        {% endif %}
        </li>
      {% endfor %}
    {% endif %}
  </ul>
{% if not _remove_wrapper %}
</div>
{% endif %}

{% endspaceless %}
